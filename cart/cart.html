<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keranjang</title>
  <link rel="stylesheet" href="../cart/style.css">
</head>
<body>
  <!-- HEADER -->
  <header class="cart-header">
    <div class="container">
      <a href="../index.html" class="logo">
        <img src="../assets/images/logo.png" alt="Glowing">
      </a>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <h1 class="header-title">Keranjang Belanja</h1>
    <div id="cart-container" class="container">
      <!-- Produk keranjang akan dimuat di sini -->
    </div>
    <div id="total-price-container" class="container">
      <h3>Total Harga: Rp. <span id="total-price">0</span></h3>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="cart-footer">
    <div class="container">
      <p class="footer-text">Â© 2024 Glowing - Reveal The Beauty of Skin</p>
    </div>
  </footer>

  <script>
    // Menambahkan Navbar dan Footer secara dinamis
    // Memuat Navbar
    fetch("components/navbar.html")
      .then((response) => response.text())
      .then((data) => {
        document.getElementById("navbar-placeholder").innerHTML = data;
      })
      .catch((error) => console.error("Error loading navbar:", error));

    // Memuat Footer
    fetch("components/footer.html")
      .then((response) => response.text())
      .then((data) => {
        document.getElementById("footer-placeholder").innerHTML = data;
      })
      .catch((error) => console.error("Error loading footer:", error));

    // Fungsi untuk menampilkan produk di keranjang dengan harga dalam IDR
    function loadCart() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const cartListContainer = document.getElementById("cart-list");
      cartListContainer.innerHTML = "";

      // Fungsi untuk format harga dalam IDR
      const formatCurrency = (value) => {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
        }).format(value);
      };

      cart.forEach((item, index) => {
        const cartItem = document.createElement("div");
        cartItem.classList.add("col-md-12");
        cartItem.classList.add("mb-3");
        cartItem.innerHTML = `
                  <div class="cart-item">
                      <div class="d-flex justify-content-between">
                          <h5>${item.name}</h5>
                          <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">Remove</button>
                      </div>
                      <p>Price: ${formatCurrency(item.price)}</p>
                      <p>Quantity: <input type="number" value="${item.quantity}" min="1" onchange="updateQuantity(${index}, this.value)" class="form-control w-25"></p>
                      <p>Total: ${formatCurrency(item.price * item.quantity)}</p>
                  </div>
              `;
        cartListContainer.appendChild(cartItem);
      });

      updateCartItemCount(); // Memperbarui jumlah item di navbar setelah memuat cart
    }

    // Fungsi untuk mengupdate jumlah item di cart di navbar
    function updateCartItemCount() {
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const totalItems = cart.reduce((acc, item) => acc + item.quantity, 0); // Hitung jumlah total item berdasarkan quantity
      const cartItemCount = document.getElementById("cart-item-count");
      cartItemCount.textContent = totalItems; // Update jumlah item di badge
    }

    // Fungsi untuk menghapus produk dari keranjang
    function removeFromCart(index) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart.splice(index, 1); // Hapus item berdasarkan index
      localStorage.setItem("cart", JSON.stringify(cart));
      loadCart(); // Reload cart setelah item dihapus
    }

    // Fungsi untuk memperbarui kuantitas produk
    function updateQuantity(index, newQuantity) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart[index].quantity = parseInt(newQuantity, 10);
      localStorage.setItem("cart", JSON.stringify(cart));
      loadCart(); // Reload cart setelah kuantitas diperbarui
    }

    // Fungsi untuk mengosongkan keranjang
    function clearCart() {
      localStorage.removeItem("cart");
      loadCart(); // Reload cart setelah dikosongkan
    }

    // Memuat keranjang dan mengupdate jumlah item di navbar saat halaman dimuat
    window.onload = function () {
      loadCart(); // Memuat item keranjang
      updateCartItemCount(); // Memperbarui jumlah item di navbar
    };
  </script> 
</body>
</html>
